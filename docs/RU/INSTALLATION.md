# Руководство по установке ControlBot

Подробное руководство по установке и настройке ControlBot на Windows.

## Содержание

- [Предварительные требования](#предварительные-требования)
- [Автоматическая установка](#автоматическая-установка-рекомендуется)
- [Ручная установка](#ручная-установка)
- [Настройка автозапуска](#настройка-автозапуска)
- [Решение проблем](#решение-проблем)

## Предварительные требования

### Обязательные
- **Windows 10/11** или более поздняя версия
- **Python 3.11+** - [Скачать](https://www.python.org/downloads/)
- **Git** (для клонирования) - [Скачать](https://git-scm.com/downloads)
- **Токен Telegram-бота** - получите от [@BotFather](https://t.me/BotFather)
- **Telegram User ID** - получите от [@userinfobot](https://t.me/userinfobot)

### Проверка Python

Откройте командную строку (Win+R → `cmd`) и выполните:

```bash
python --version
```

Должна отобразиться версия Python 3.11 или выше.

## Автоматическая установка (рекомендуется)

Самый простой способ установки и настройки бота.

### Шаг 1: Клонирование репозитория

```bash
git clone https://github.com/Eklipti/TelegramControlBot.git
cd TelegramControlBot
```

### Шаг 2: Запуск setup.bat

Дважды кликните на `setup.bat` или запустите из командной строки:

```bash
setup.bat
```

**Что делает скрипт:**
1. ✅ Проверяет наличие и версию Python
2. ✅ Создает виртуальное окружение `.venv`
3. ✅ Активирует виртуальное окружение
4. ✅ Обновляет pip до последней версии
5. ✅ Устанавливает все зависимости из `requirements.txt`
6. ✅ Создает `.env` файл из `.env.example`
7. ✅ Создает необходимые директории (logs, data, exports)

### Шаг 3: Настройка .env файла

Откройте файл `.env` в текстовом редакторе (Блокнот, Notepad++, VS Code):

```env
# Токен вашего Telegram-бота (получите от @BotFather)
TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz

# ID разрешенных пользователей через запятую (получите от @userinfobot)
ALLOWED_USER_IDS=123456789,987654321

# Уровень логирования (DEBUG, INFO, WARNING, ERROR, CRITICAL)
LOG_LEVEL=INFO
```

**Обязательные параметры:**
- `TELEGRAM_BOT_TOKEN` - токен вашего бота
- `ALLOWED_USER_IDS` - ваш Telegram ID

### Шаг 4: Запуск бота

Дважды кликните на `start.bat` или запустите:

```bash
start.bat
```

Бот запустится в отдельном окне консоли.

## Управление ботом

### Запуск

```bash
start.bat
```

### Остановка

Закройте окно консоли или нажмите `Ctrl+C`

### Просмотр логов

Логи находятся в директории `logs/`:
- `all.log` - все сообщения
- `error.log` - только ошибки
- `info.log` - информационные сообщения
- `debug.log` - отладочные сообщения

## Настройка автозапуска

### Установка в автозагрузку

Запустите `install_autostart.bat`:

```bash
install_autostart.bat
```

**Что делает скрипт:**
- Создает ярлык на `start.bat` в папке автозагрузки Windows
- Бот будет автоматически запускаться при входе в систему

**Расположение ярлыка:**
```
%APPDATA%\Microsoft\Windows\Start Menu\Programs\Startup\ControlBot.lnk
```

### Удаление из автозагрузки

Запустите `uninstall_autostart.bat`:

```bash
uninstall_autostart.bat
```

Или вручную:
1. Нажмите `Win+R`
2. Введите: `shell:startup`
3. Удалите ярлык `ControlBot.lnk`

## Ручная установка

Для тех, кто предпочитает полный контроль над процессом установки.

### Шаг 1: Клонирование

```bash
git clone https://github.com/Eklipti/TelegramControlBot.git
cd TelegramControlBot
```

### Шаг 2: Создание виртуального окружения

```bash
python -m venv .venv
```

### Шаг 3: Активация виртуального окружения

```bash
.venv\Scripts\activate
```

Вы должны увидеть `(.venv)` в начале строки командной строки.

### Шаг 4: Обновление pip

```bash
python -m pip install --upgrade pip
```

### Шаг 5: Установка зависимостей

```bash
pip install -r requirements.txt
```

### Шаг 6: Создание .env файла

```bash
copy .env.example .env
```

Затем отредактируйте `.env` как описано выше.

### Шаг 7: Создание директорий

```bash
mkdir logs data exports
```

### Шаг 8: Запуск

```bash
python main.py
```

## Обновление бота

### Автоматический способ

```bash
# Остановите бота (закройте окно или Ctrl+C)

# Обновите код
git pull

# Запустите setup.bat для обновления зависимостей
setup.bat

# Запустите бота
start.bat
```

### Ручной способ

```bash
# Остановите бота
# Обновите код
git pull

# Активируйте окружение
.venv\Scripts\activate

# Обновите зависимости
pip install -r requirements.txt --upgrade

# Запустите бота
python main.py
```

## Решение проблем

### Python не найден

**Проблема:** При запуске `setup.bat` выводится "Python не найден"

**Решение:**
1. Установите Python 3.11+ с официального сайта
2. При установке обязательно отметьте "Add Python to PATH"
3. Перезапустите командную строку
4. Проверьте: `python --version`

### Не удалось создать виртуальное окружение

**Проблема:** Ошибка при создании `.venv`

**Решение:**
```bash
# Установите venv модуль
python -m pip install virtualenv

# Или используйте virtualenv
virtualenv .venv
```

### Ошибки при установке зависимостей

**Проблема:** Ошибки при установке пакетов из `requirements.txt`

**Решение:**
```bash
# Обновите pip
python -m pip install --upgrade pip

# Установите wheel
pip install wheel

# Попробуйте снова
pip install -r requirements.txt
```

### Бот не запускается

**Проблема:** Окно консоли сразу закрывается или ошибка

**Решение:**
1. Проверьте файл `.env` - токен и ID должны быть корректными
2. Проверьте логи в директории `logs/error.log`
3. Запустите вручную для просмотра ошибок:
   ```bash
   .venv\Scripts\activate
   python main.py
   ```

### Автозапуск не работает

**Проблема:** Бот не запускается при входе в Windows

**Решение:**
1. Проверьте наличие ярлыка: `Win+R` → `shell:startup`
2. Убедитесь что ярлык указывает на правильный путь к `start.bat`
3. Попробуйте запустить `start.bat` вручную
4. Проверьте права доступа к папке проекта

### GUI функции не работают

**Проблема:** Скриншоты, управление мышью/клавиатурой не работает

**Решение:**
1. Убедитесь что вы запускаете бота на машине с активным дисплеем
2. Проверьте установку GUI библиотек:
   ```bash
   pip install pyautogui pillow opencv-python
   ```
3. На Windows может потребоваться запуск с правами администратора для некоторых функций

## Полезные команды

### Проверка статуса виртуального окружения

```bash
# Активировано ли окружение?
echo %VIRTUAL_ENV%

# Список установленных пакетов
pip list
```

### Очистка и переустановка

```bash
# Удалить виртуальное окружение
rmdir /s /q .venv

# Запустить setup.bat заново
setup.bat
```

### Резервное копирование конфигурации

```bash
# Создайте резервную копию важных файлов
copy .env .env.backup
xcopy /E /I logs logs_backup
xcopy /E /I data data_backup
```

## Дополнительные ресурсы

- **[README.md](../../README.md)** - основная документация
- **[CHANGELOG.md](CHANGELOG.md)** - история изменений
- **[CONFIG.md](CONFIG.md)** - подробное описание конфигурации
- **[COMMANDS.md](COMMANDS.md)** - справочник команд
- **[GitHub Issues](https://github.com/Eklipti/TelegramControlBot/issues)** - сообщения об ошибках и вопросы

---

**При возникновении проблем создайте [Issue](https://github.com/Eklipti/TelegramControlBot/issues) на GitHub с подробным описанием и логами.**

